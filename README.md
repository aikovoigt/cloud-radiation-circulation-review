# cloud-radiation-circulation-review

Documentation of plotting and analysis scripts for A. Voigt et al., Clouds, radiation and atmospheric circulation in the present-day climate and under climate change, submitted to WIREs Climate Change in July 2020.

The plotting scripts and the resulting figures are provided in separate subdirectories of the directory `figures`. The analysis script for the circulation metrics for table 1 is provided in the directory `tables/table-1`.

The data used for the figures and the circulation metrics is provided in an external tarball, from which it can be downloaded and untared to populate the data directory. During the reviewing phase, the tarball is hosted at [here](https://www.dropbox.com/s/7x9qm4dgg50g0nb/data-for-cloudreview.tar?dl=0). After acceptance, the tarball will be published with a doi at KITOpen.   

The following documents the provenance of the data, including postprocessing steps. While some of the file content and naming is described explicitly, this informaton can be fully inferred from the plotting and analysis scripts.

## Figure 1: ./data/obs/

**CERES EBAF Edition 4.1: cloud-radiative effects**

CERES EBAF estimates of cloud-radiative effects were obtained from NASA/CERES and time-averaged over the years 2007 to 2018 by means of [cdo](https://code.mpimet.mpg.de/projects/cdo/). CERES EBAF is documented in [Loeb et al. (2018)](https://doi.org/10.1175/JCLI-D-17-0208.1).

    wget https://opendap.larc.nasa.gov/opendap/CERES/EBAF/Edition4.1/CERES_EBAF_Edition4.1_200003-201911.nc
     
    cdo -timmean -yearmonmean -selyear,2007/2018 -selvar,toa_cre_sw_mon,toa_cre_lw_mon,sfc_cre_net_sw_mon,sfc_cre_net_lw_mon CERES_EBAF_Edition4.1_200003-201911.nc CERES_EBAF_Ed4.1_200701-201812.timmean.cre_toa_sfc.nc
    
For the CRE sampling on vertical velocity, the CERES EBAF data is not time-averaged, of course.

    cdo -selyear,2007/2018 -selvar,toa_cre_sw_mon,toa_cre_lw_mon,sfc_cre_net_sw_mon,sfc_cre_net_lw_mon CERES_EBAF_Edition4.1_200003-201911.nc CERES_EBAF_Ed4.1_200701-201812.cre_toa_sfc.nc
    
**ERA-Interim: vertical velocity**

Omega at 500hPha was taken from ERA-Interim for years 2007-2018. The original data was shared by Kevin Grise, who obtained it from the NCAR Research Data Archive: https://rda.ucar.edu/datasets/ds627.1/. ERA-Interim can also be obtained from ECMF: https://www.ecmwf.int/en/forecasts/datasets/reanalysis-datasets/era-interim. ERA-Interim is introduced in [Dee et al. (2011)](https://rmets.onlinelibrary.wiley.com/doi/full/10.1002/qj.828).

The data was restricted to years 2007-2018 and interpolated to the CERES EBAF grid by means of cdo. The ocean-sea mask was interpolated in the same manner:

    # obtain CERES grid
    cdo griddes CERES_EBAF_Ed4.1_200701-201812.timmean.cre_toa_sfc.nc > ceresgrid.txt

    cdo -remapcon,ceresgrid.txt -selyear,2007/2018 ERAI_omega500_monthly_1979-2018.nc ERAI_omega500_monthly_2007-2018.remapcon_ceresgrid.nc
    
    cdo -setyear,2000 -remapcon,ceresgrid.txt ERAI_land.nc ERAI_land.remapcon_ceresgrid.nc
    
**CALIPSO-GOCCP: total and high-level cloud cover**

Cloud cover is taken from CALIPSO-GOCCP for years 2007-2018. The original data was obtained from the ftp server of IPSL polytechnique. More information on CALIPSO-GOCCP is available at https://climserv.ipsl.polytechnique.fr/cfmip-obs/ and from [Chepfer et al (2010)](doi:10.1029/2009JD012251).

    wget ftp://ftp.climserv.ipsl.polytechnique.fr/cfmip/GOCCP_v3/2D_Maps/grid_2x2xL40/climato/MapLowMidHigh330m_200606-201910_avg_CFMIP2_sat_3.1.2.nc
    
    cdo -remapcon,ceresgrid.txt -selyear,2007/2018 -selvar,clhcalipso,cltcalipso MapLowMidHigh330m_200606-201910_avg_CFMIP2_sat_3.1.2.nc MapLowMidHigh330m_200606-201910_avg_CFMIP2_sat_3.1.2.2007-2018.clhcalipso_cltcalipso.remapcon_ceresgrid.nc
    
**CloudSat/CALIPSO: vertical distribution of cloud fraction**

The vertical distribution of cloud cover is based on CloudSat/CALIPSO and is generated by the binning procedure described by [Li et al. (2010)](https://doi.org/10.1002/2013JD020669). Data was provided by Ying Li.

## Figure 2: ./data/cesm/

**CESM free and locked simulations: pressure velocity at 500hPa and TOA SW CRE**

The data was provided by Brian Medeiros and is from the coupled CESM version 2.0.1 simulations of [Grise et al. (2020)](https://doi.org/10.1029/2019GL083542).

## Figure 3 and Table 1: ./data/cookie

**COOKIE simulations**

The amip and offamip simulations of CNRM-CM5, HadGEM2-A and IPSL-CM5A-LR were obtained from [esgf-data.dkrz.de](esgf-data.dkrz.de). The amip and offamip simulations of MPI-CM5 and MRI-CGCM3 were obtained from [cera-www.dkrz.de](cera-www.dkrz.de) by Nicole Albern. They were postprocessed by Aiko Voigt by means of cdo: time-averaged between years 1980 and 2008, and for plotting purposes further interpolated to a common 2x2 lat-lon grid. The circulation metrics of Table 1 are calculated on the models' native grids. For example,

    cdo -remapcon,r180x90 -timmean -yearmonmean -selyear,1980/2008 pr_MRI-CGCM3_amip.nc pr_MRI-CGCM3_amip.timmean_1980-2008.remapcon_r180x90.nc

 and 
    
    cdo -timmean -yearmonmean -selyear,1980/2008 pr_MRI-CGCM3_amip.nc pr_MRI-CGCM3_amip.timmean_1980-2008.nc

Furthermore, the mass stream function was calculated by means of the `cdo mastrfu` operator using time- and zonally-averaged meridional wind. E.g.,

    cdo mastrfu -zonmean va_MRI-CGCM3_amip.timmean_1980-2008.nc msf_MRI-CGCM3_amip.timmean_1980-2008.nc

The `pr` files contain precipitation, the `ua850` files contain the zonal wind at 850hPa, the `va` files contain the meridional wind, and the `msf` files contain the mass stream function.

## Figure 4: ./data/enso/

**ENSO power spectra**

The CESM1.2 model data is from [Middlemas et al. (2019)](https://doi.org/10.1175/JCLI-D-18-0842.1), the MPI-ESM-LR model is from [Raedel et al. (2016)](https://www.nature.com/articles/ngeo2630). The CESM1.2 data was provided from Brian Medeiros in a form that already included the time series of the Nino3.4 index. For MPI-ESM-LR, which was provided by Thorsten Mauritsen, the Nino3.4 index was calculated by [cdo](https://code.mpimet.mpg.de/projects/cdo/):

    cdo -fldmean -sellonlatbox,190,240,-5.2,5.2 piControl_r1i1p1-LR_echam6_BOT_mm_1850-2849.tsurf_temp2.nc piControl_r1i1p1-LR_echam6_BOT_mm_1850-2849.tsurf_temp2.nino34-fldmean.nc
    cdo -fldmean -sellonlatbox,190,240,-5.2,5.2 BOT_fixvar_random_1900-2100.tsurf_temp2.nc BOT_fixvar_random_1900-2100.tsurf_temp2.nino34-fldmean.nc

The data is not included in the data tarball - to obtain the data for both models, please contact the corresponding authors of Middlemas et al. (2019) and Raedel et al. (2016). 

## Figures 5, 6 and 7: ./data/climatechange/

**MPI-ESM-LR simulations: decomposition of total warming response into non-cloud and cloud-related changes**

The data is taken from the slab-ocean control and 4xCO2 simulations with MPI-ESM-LR described in [Voigt et al. (2019)](https://doi.org/10.1175/JCLI-D-18-0810.1). The `ATM ` files contain the zonal-mean time-mean values of atmospheric temperature and zonal wind for the 2 free simulations (control and 4xCO2) and for the accompanying 8 locked simulations. The zonal-mean time-mean tropopause pressure diagnosed by NCL is also provided for the free control simulation in an additional file. 

**CMIP5 models: cloud-induced change in top-of-atmosphere, surface and vertically-integrated atmospheric radiative heating**

Cloud-radiative heating changes from CMIP5 abrupt4xCO2 simulations were calculated from a combination of radiative kernels and surface temperature regressions. The heating changes are provided in the `cloud_feedback` files for 26 models. Data provided by Paulo Ceppi.

**CAM4, MPI-ESM-LR, IPSL-CM5A-LR, ICON: cloud-induced change in vertically-resolved atmosphere radiative heating**

PRP-diagnosed changes in cloud-radiative heating for four global models, plus changes in cloud fraction and the control tropopause height. The CAM4 and MPI-ESM-LR (`echam6`) data was provided by Paulo Ceppi and is from [Ceppi and Shepherd (2017)](https://doi.org/10.1175/JCLI-D-17-0189.1). The IPSL-CM5A-LR (`l5aa`) and ICON-NWP data was provided by Aiko Voigt and is from [Voigt et al. (2019)](https://doi.org/10.1175/JCLI-D-18-0810.1).
